---
import 'ress/dist/ress.min.css'
import Layout from '../layouts/layout.astro'
import { HeroSectionComponent } from '../components/sections/hero/hero'
import { AboutUsSectionComponent } from '../components/sections/about-us/about-us'
import { HowWeWorkSectionComponent } from '../components/sections/how-we-work/how-we-work'
import { getImage } from 'astro:assets'
import bgImage from '../assets/images/bg.png'
import heroImage from '../assets/images/hero-image.png'
import slideImage1 from '../assets/images/slide-image-1.png'
import slideImage2 from '../assets/images/slide-image-2.png'
import slideImage3 from '../assets/images/slide-image-3.png'
import slideImage4 from '../assets/images/slide-image-4.png'
import aboutUsImage from '../assets/images/about-us-image.png'

const { src: bgImageSrc } = await getImage({
  src: bgImage,
  alt: 'Хлеб&Печь',
  format: 'webp',
})

const { src: heroSectionImageSrc } = await getImage({
  src: heroImage,
  alt: 'Хлеб&Печь',
  format: 'webp',
  width: 665,
  height: 414,
})

const howWeWorkImages = await Promise.all(
  [slideImage1, slideImage2, slideImage3, slideImage4].map(async img => {
    const { src } = await getImage({
      src: img,
      alt: 'Хлеб&Печь',
      format: 'webp',
      width: 270,
      height: 300,
    })

    return src
  }),
)

const { src: aboutUsSectionImageSrc } = await getImage({
  src: aboutUsImage,
  alt: 'Хлеб&Печь',
  format: 'webp',
  width: 635,
  height: 735,
})

const backgroundImage = `url(${bgImageSrc})`
---

<Layout>
  <main class="main-layout">
    <HeroSectionComponent image={heroSectionImageSrc} client:load />
    <HowWeWorkSectionComponent images={howWeWorkImages} client:load />
    <AboutUsSectionComponent image={aboutUsSectionImageSrc} client:load />
  </main>
</Layout>

<style define:vars={{ backgroundImage }}>
  .main-layout::before {
    content: '';
    width: 100vw;
    height: 100vw;
    position: fixed;
    background-image: var(--backgroundImage);
    background-position: -5%;
    background-repeat: repeat;
    z-index: -1;
  }
</style>
